var Page={enData:[],heData:[],arData:[],firstTime:!0,framesVisible:!1,currentLang:"en",currentEdit:0,textRevealed:!1,currentToLoad:2,currentToShow:0,months:["January","February","March","April","May","June","July","August","September","October","November","December"],init:function(){console.log("Page.init"),this.bindEvents(),this.loadingAnim()},bindEvents:function(){console.log("Page.bindEvents");var a=this;$("#en_link").on("click",function(){a.switchLang("en"),$(this).addClass("selected").siblings().removeClass("selected"),a.textRevealed||a.showText()}),$("#he_link").on("click",function(){a.switchLang("he"),$(this).addClass("selected").siblings().removeClass("selected"),a.textRevealed||a.showText()}),$("#ar_link").on("click",function(){a.switchLang("ar"),$(this).addClass("selected").siblings().removeClass("selected"),a.textRevealed||a.showText()}),$("#down_arrow img").on("click",function(){a.showText()})},loadingAnim:function(){console.log("Page.loadingAnim");var a=this;$("body").css("background-color","white"),setTimeout(function(){a.loadLangData("en","Jerusalem")},500)},loadLangData:function(a,b){console.log("Page.loadLangData",a,b);var c=this;$.ajax({url:"https://"+a+".wikipedia.org/w/api.php?action=query&format=json&prop=revisions&list=&titles="+b+"&rvlimit=500",dataType:"jsonp",headers:{"Api-User-Agent":"Palimpsest/1.1 (https://palimpsest.void.xxx/; fredcave@hotmail.com)"},success:function(b){var d=b.query.pages[Object.keys(b.query.pages)[0]];console.log(118,d),"en"===a?c.enData=d.revisions:"he"===a?c.heData=d.revisions:"ar"===a&&(c.arData=d.revisions),c.heData.length?c.arData.length||c.loadLangData("ar","القدس"):c.loadLangData("he","ירושלים"),c.firstTime&&(c.initialLoad(),c.firstTime=!1)}})},initialLoad:function(){console.log("Page.initialLoad");for(var a=this,b=0;b<2;){var c=this.getSrc();$("#wrapper_"+this.currentLang+" iframe").eq(b).attr({src:c[0],"data-date":c[1]}),b++}this.interval="",_.defer(function(){a.interval=setInterval(function(){a.frameLoop()},3e3)}),setTimeout(function(){for(b=0;b<2;){var c=a.getSrc("he");$("#wrapper_he iframe").eq(b).attr({src:c[0],"data-date":c[1]}),b++}setTimeout(function(){for(b=0;b<2;){var c=a.getSrc("ar");$("#wrapper_ar iframe").eq(b).attr({src:c[0],"data-date":c[1]}),b++}},1e3)},1e3)},getSrc:function(a){console.log("Page.getSrc");var b,c,d,e=30,f=a||this.currentLang;"en"===f?(d=this.enData,c="Jerusalem"):"he"===f?(d=this.heData,c="ירושלים"):"ar"===f&&(d=this.arData,c="القدس");var b=d[this.currentEdit],g="https://"+f+".wikipedia.org/w/index.php?title="+c+"&oldid="+b.revid;this.currentEdit=this.currentEdit+e,this.currentEdit>=d.length&&(this.currentEdit=0);var h=b.timestamp.split("-"),i=h[2].split("T")[0],j=this.months[h[1]-1],k=h[0],l=i+"-"+j+"-"+k,m=[g,l];return m},frameLoop:function(a){console.log("Page.frameLoop");var b=this,c=a||this.currentLang,d=this.getSrc(c);$("#wrapper_"+c+" iframe").eq(this.currentToLoad).off("load"),$("#wrapper_"+c+" iframe").eq(this.currentToLoad).attr({src:d[0],"data-date":d[1]}),this.framesVisible||($("#global_iframe_wrapper").css("opacity","1"),$("#wrapper").css("opacity","0.5"),$("#loading").css("opacity","0"),setTimeout(function(){$("#loading").hide()},2e3),this.framesVisible=!0),$("#wrapper_"+c+" iframe").eq(this.currentToShow).css("opacity","1").nextAll().css("opacity","0"),this.currentToShow++,this.currentToShow>=3&&(this.currentToShow=0),this.currentToLoad++,this.currentToLoad>=3&&(this.currentToLoad=0),_.defer(function(){b.showInfo($("#wrapper_"+c+" iframe").eq(b.currentToShow-1).attr("data-date"))})},showInfo:function(a){console.log("Page.showInfo",a);var b=this,c=1,d=a.split("-"),e=d[0],f=d[1],g=d[2],h=setInterval(function(){$("#top_bar_info .month").text(b.months[c]),c++},100);setTimeout(function(){$("#top_bar_info .day").prop("number",1).animateNumber({number:e}),$("#top_bar_info .month").text(f),$("#top_bar_info .year").prop("number",2e3).animateNumber({number:g}),clearInterval(h)},500)},switchLang:function(a){console.log("Page.switchLang",a);a!==this.currentLang&&("en"===a?$("#text-en").show().siblings(".text").hide():"he"===a?$("#text-he").show().siblings(".text").hide():"ar"===a&&$("#text-ar").show().siblings(".text").hide(),this.currentLang=a,this.currentToLoad=2,this.currentToShow=0,this.currentEdit=0,$("#wrapper_"+a).show().siblings(".iframes_wrapper").hide(),this.frameLoop(a))},showText:function(){console.log("Page.showText"),$("#down_arrow").fadeOut(),setTimeout(function(){$("body").css({"overflow-y":"scroll",height:"auto"}),$("#wrapper").css({"overflow-y":"auto"}),_.defer(function(){$("#text_wrapper").css({"margin-top":"18.5vh"})}),$("#loading").css("opacity","0"),setTimeout(function(){$("#loading").hide()},2e3)},500),this.textRevealed=!0}};$(document).on("ready",function(){$("html,body").animate({scrollTop:0},100),Page.init()}),function(a){var b=function(a){return a.split("").reverse().join("")},c={numberStep:function(b,c){var d=Math.floor(b);a(c.elem).text(d)}},d=function(a){var b=a.elem;b.nodeType&&b.parentNode&&(b=b._animateNumberSetter,b||(b=c.numberStep),b(a.now,a))};a.Tween&&a.Tween.propHooks?a.Tween.propHooks.number={set:d}:a.fx.step.number=d,a.animateNumber={numberStepFactories:{append:function(b){return function(c,d){var e=Math.floor(c);a(d.elem).prop("number",c).text(e+b)}},separator:function(c,d,e){return c=c||" ",d=d||3,e=e||"",function(f,g){var h=0>f,i=Math.floor((h?-1:1)*f).toString(),j=a(g.elem);if(i.length>d){for(var k,l,m,n=i,o=d,p=n.split("").reverse(),i=[],q=0,r=Math.ceil(n.length/o);q<r;q++){for(k="",m=0;m<o&&(l=q*o+m,l!==n.length);m++)k+=p[l];i.push(k)}n=i.length-1,o=b(i[n]),i[n]=b(parseInt(o,10).toString()),i=i.join(c),i=b(i)}j.prop("number",f).text((h?"-":"")+i+e)}}}},a.fn.animateNumber=function(){for(var b=arguments[0],d=a.extend({},c,b),e=a(this),f=[d],g=1,h=arguments.length;g<h;g++)f.push(arguments[g]);if(b.numberStep){var i=this.each(function(){this._animateNumberSetter=b.numberStep}),j=d.complete;d.complete=function(){i.each(function(){delete this._animateNumberSetter}),j&&j.apply(this,arguments)}}return e.animate.apply(e,f)}}(jQuery);